<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Quiz Night Deluxe (Standalone)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <!-- Load the question library -->
    <!-- <script src="questions.js" defer></script> --> <!-- This line is removed -->
    <style>
        :root {
            --bg-primary: #0f172a; --bg-secondary: #1e293b; --bg-tertiary: #334155;
            --text-primary: #f1f5f9; --text-secondary: #94a3b8; --border-color: #334155;
            --accent-color: #8b5cf6; --header-gradient-from: #a855f7; --header-gradient-to: #ec4899;
        }
        body.theme-retro-wave {
            --bg-primary: #1a0b2e; --bg-secondary: #2a1147; --bg-tertiary: #4a2d73;
            --text-primary: #f0d4ff; --text-secondary: #a37de0; --border-color: #4a2d73;
            --accent-color: #f6218e; --header-gradient-from: #ff7f50; --header-gradient-to: #f6218e;
        }
        body.theme-jungle-vibe {
            --bg-primary: #0a1d13; --bg-secondary: #123824; --bg-tertiary: #205c3b;
            --text-primary: #e8f8f0; --text-secondary: #79d49e; --border-color: #205c3b;
            --accent-color: #facc15; --header-gradient-from: #fde047; --header-gradient-to: #bef264;
        }
        body.theme-ocean-deep {
            --bg-primary: #021a30; --bg-secondary: #053059; --bg-tertiary: #0b4f8a;
            --text-primary: #d6f5ff; --text-secondary: #7cc9f5; --border-color: #0b4f8a;
            --accent-color: #22d3ee; --header-gradient-from: #67e8f9; --header-gradient-to: #5eead4;
        }
        body.theme-crimson-dark {
            --bg-primary: #260202; --bg-secondary: #4f0303; --bg-tertiary: #750d0d;
            --text-primary: #fee2e2; --text-secondary: #fca5a5; --border-color: #5f0b0b;
            --accent-color: #ef4444; --header-gradient-from: #f87171; --header-gradient-to: #dc2626;
        }
        body.theme-crimson-light {
            --bg-primary: #fffbff; --bg-secondary: #fee2e2; --bg-tertiary: #fecaca;
            --text-primary: #450a0a; --text-secondary: #991b1b; --border-color: #fca5a5;
            --accent-color: #dc2626; --header-gradient-from: #ef4444; --header-gradient-to: #b91c1c;
        }
        body.theme-sapphire-dark {
            --bg-primary: #0c152f; --bg-secondary: #182952; --bg-tertiary: #253b7c;
            --text-primary: #e0e7ff; --text-secondary: #a5b4fc; --border-color: #1e3a8a;
            --accent-color: #60a5fa; --header-gradient-from: #93c5fd; --header-gradient-to: #3b82f6;
        }
         body.theme-sapphire-light {
            --bg-primary: #f0f9ff; --bg-secondary: #dbeafe; --bg-tertiary: #bfdbfe;
            --text-primary: #1e3a8a; --text-secondary: #1d4ed8; --border-color: #93c5fd;
            --accent-color: #2563eb; --header-gradient-from: #3b82f6; --header-gradient-to: #1d4ed8;
        }
        body.theme-emerald-dark {
            --bg-primary: #04120a; --bg-secondary: #062111; --bg-tertiary: #05331c;
            --text-primary: #d1fae5; --text-secondary: #6ee7b7; --border-color: #064e3b;
            --accent-color: #34d399; --header-gradient-from: #6ee7b7; --header-gradient-to: #10b981;
        }
        body.theme-emerald-light {
            --bg-primary: #f0fdf4; --bg-secondary: #dcfce7; --bg-tertiary: #bbf7d0;
            --text-primary: #064e3b; --text-secondary: #059669; --border-color: #86efac;
            --accent-color: #10b981; --header-gradient-from: #34d399; --header-gradient-to: #059669;
        }

        body { font-family: 'Inter', sans-serif; touch-action: manipulation; background-color: var(--bg-primary); color: var(--text-primary); transition: background-color 0.3s, color 0.3s; }
        .arabic-text, .arabic-text * { font-family: 'Noto Sans Arabic', sans-serif; }
        .timer-progress { stroke-dasharray: 283; stroke-dashoffset: 283; transition: stroke-dashoffset 1s linear; transform: rotate(-90deg); transform-origin: 50% 50%; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .bg-main-secondary { background-color: var(--bg-secondary); } .bg-main-tertiary { background-color: var(--bg-tertiary); }
        .text-main-secondary { color: var(--text-secondary); } .border-main { border-color: var(--border-color); }
        .accent-text { color: var(--accent-color); } .accent-bg { background-color: var(--accent-color); }
        .answer-btn { background-color: var(--bg-tertiary); transition: all 0.2s ease-in-out; }
        .answer-btn:hover { filter: brightness(1.15); } .answer-btn.selected { transform: scale(1.02); box-shadow: 0 0 15px var(--accent-color); border-color: var(--accent-color); }
        .answer-btn.correct { background-color: #22c55e !important; border-color: #16a34a !important; color: white; }
        .answer-btn.wrong { background-color: #ef4444 !important; border-color: #dc2626 !important; color: white; }
        .lang-line { display: flex; align-items: center; gap: 0.5rem; width: 100%; }
        .lang-line.rtl { flex-direction: row-reverse; } .lang-line.rtl span { text-align: right; }
        .control-btn, .header-icon-btn { background-color: rgba(255, 255, 255, 0.1); border-radius: 9999px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s; color: var(--text-primary); border: none; cursor: pointer; }
        .control-btn:hover, .header-icon-btn:hover { background-color: rgba(255, 255, 255, 0.2); }
        .setup-input { background-color: var(--bg-primary); border: 2px solid var(--border-color); border-radius: 0.5rem; padding: 0.75rem 1rem; color: var(--text-primary); font-weight: 600; transition: border-color 0.2s; width: 100%; }
        .setup-input:focus { outline: none; border-color: var(--accent-color); }
        .setup-option-btn { background-color: var(--bg-tertiary); border: 2px solid transparent; color: var(--text-primary); }
        .setup-option-btn.selected { background-color: var(--accent-color); border-color: var(--accent-color); color: white; }
        .theme-btn { width: 40px; height: 40px; border-radius: 9999px; border: 3px solid var(--bg-tertiary); transition: all 0.2s ease-in-out; cursor: pointer; }
        .theme-btn.selected { border-color: var(--accent-color); transform: scale(1.15); box-shadow: 0 0 10px var(--accent-color); }
        #theme-retro-wave { background: linear-gradient(45deg, #f6218e, #7f22e3); } #theme-jungle-vibe { background: linear-gradient(45deg, #facc15, #4d7c0f); }
        #theme-ocean-deep { background: linear-gradient(45deg, #22d3ee, #053059); } #theme-crimson-dark { background: linear-gradient(45deg, #ef4444, #7f1d1d); }
        #theme-crimson-light { background: linear-gradient(45deg, #f87171, #fee2e2); } #theme-sapphire-dark { background: linear-gradient(45deg, #60a5fa, #1e3a8a); }
        #theme-sapphire-light { background: linear-gradient(45deg, #93c5fd, #dbeafe); } #theme-emerald-dark { background: linear-gradient(45deg, #34d399, #064e3b); }
        #theme-emerald-light { background: linear-gradient(45deg, #6ee7b7, #d1fae5); }
        .header-gradient { background-image: linear-gradient(to right, var(--header-gradient-from), var(--header-gradient-to)); }
        .lang-checkbox-label { display: flex; align-items: center; cursor: pointer; padding: 0.5rem 1rem; border-radius: 0.5rem; background-color: var(--bg-tertiary); border: 2px solid var(--border-color); transition: all 0.2s; }
        .lang-checkbox-label:hover { border-color: var(--accent-color); } .lang-checkbox { display: none; }
        .lang-checkbox:checked + .lang-checkbox-label { background-color: var(--accent-color); border-color: var(--accent-color); color: white; }
    </style>
</head>
<!-- Set default theme on the body -->
<body class="theme-crimson-light">
    <!-- Top Bar -->
    <header class="p-3 bg-main-secondary/50 backdrop-blur-sm shadow-lg sticky top-0 z-50">
        <div class="w-full max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                 <svg class="h-8 w-8 accent-text" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h1 class="text-xl font-bold text-main-primary hidden sm:block">Family Quiz Night</h1>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="goToHome()" class="header-icon-btn" title="Home">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M6.5 14.5v-3.505c0-.245.25-.495.5-.495h2c.25 0 .5.25.5.5v3.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5"/></svg>
                </button>
                <button onclick="openSettings()" class="header-icon-btn" title="Settings">
                     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311a1.464 1.464 0 0 1-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858"/></svg>
                </button>
            </div>
        </div>
    </header>

    <main class="p-4">
        <!-- Home Screen -->
        <div id="home-screen" class="w-full max-w-3xl mx-auto text-center fade-in md:py-12">
            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text header-gradient mb-6">Welcome!</h1>
            <div class="bg-main-secondary p-4 md:p-8 rounded-2xl shadow-2xl">
                <div id="quote-section" class="mb-8 p-4 border-2 border-main rounded-xl italic">
                    <p id="quote-text" class="text-lg text-main-secondary"></p>
                    <p id="quote-author" class="text-right mt-2 font-semibold text-main-primary"></p>
                </div>
                <button onclick="showScreen('setup-screen')" class="w-full accent-bg hover:brightness-110 text-white font-bold py-3 px-6 rounded-lg shadow-lg text-xl transition-all transform hover:scale-105">
                    Create New Game
                </button>
            </div>
             <div class="bg-main-secondary p-4 md:p-6 rounded-2xl shadow-2xl mt-8 text-left">
                <h3 class="text-2xl font-bold accent-text mb-4 text-center">ðŸ’¡ Team Creation Ideas</h3>
                <ul class="space-y-3 text-main-secondary list-disc list-inside">
                    <li><strong class="text-main-primary">Generations Clash:</strong> Team "Boomers" vs. Team "Zoomers".</li>
                    <li><strong class="text-main-primary">Battle of the Sexes:</strong> Boys vs. Girls. A true classic!</li>
                    <li><strong class="text-main-primary">Kids vs. Adults:</strong> Let the kids team up against the grown-ups.</li>
                    <li><strong class="text-main-primary">Random Draw:</strong> Write names on pieces of paper and draw teams randomly for a fun mix.</li>
                    <li><strong class="text-main-primary">In-Laws vs. Out-Laws:</strong> A fun way to pit family branches against each other.</li>
                </ul>
            </div>
        </div>
        
        <!-- Setup Screen -->
        <div id="setup-screen" class="hidden w-full max-w-4xl mx-auto text-center fade-in md:py-12">
            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text header-gradient mb-6">Game Setup</h1>
            <div id="setup-content" class="bg-main-secondary p-4 md:p-8 rounded-2xl shadow-2xl">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Left Column: Game Settings -->
                    <div class="space-y-6">
                        <div>
                            <label class="block text-lg font-semibold text-main-secondary mb-3">Number of Teams</label>
                            <div class="flex justify-center gap-2 md:gap-3">
                                <button onclick="selectNumberOfTeams(2, this)" class="setup-option-btn font-bold py-2 px-4 rounded-lg selected">2</button>
                                <button onclick="selectNumberOfTeams(3, this)" class="setup-option-btn font-bold py-2 px-4 rounded-lg">3</button>
                                <button onclick="selectNumberOfTeams(4, this)" class="setup-option-btn font-bold py-2 px-4 rounded-lg">4</button>
                            </div>
                        </div>
                        <div><label class="block text-lg font-semibold text-main-secondary mb-3">Difficulty</label><div id="difficulty-selector" class="grid grid-cols-2 gap-2"><button onclick="selectDifficulty('easy', this)" class="setup-option-btn font-bold py-2 px-4 rounded-lg">Easy</button><button onclick="selectDifficulty('medium', this)" class="setup-option-btn font-bold py-2 px-4 rounded-lg selected">Medium</button><button onclick="selectDifficulty('hard', this)" class="setup-option-btn font-bold py-2 px-4 rounded-lg">Hard</button><button onclick="selectDifficulty('mixed', this)" class="setup-option-btn font-bold py-2 px-4 rounded-lg">Mixed</button></div></div>
                        <div><label class="block text-lg font-semibold text-main-secondary mb-3">Number of Questions</label><div id="quantity-selector" class="flex justify-center gap-2 md:gap-3"><button onclick="selectQuantity(15, this)" class="setup-option-btn font-bold py-2 px-4 rounded-lg">15</button><button onclick="selectQuantity(30, this)" class="setup-option-btn font-bold py-2 px-4 rounded-lg selected">30</button><button onclick="selectQuantity(50, this)" class="setup-option-btn font-bold py-2 px-4 rounded-lg">50</button></div></div>
                        <div><label for="time-limit-slider" class="block text-lg font-semibold text-main-secondary mb-3">Time per Question</label><div class="flex items-center justify-center gap-4 px-2"><input type="range" id="time-limit-slider" min="10" max="300" value="60" step="5" class="w-full h-2 bg-main-tertiary rounded-lg appearance-none cursor-pointer accent-bg" oninput="updateTimerSelection(this.value)"><span id="time-limit-display" class="font-bold text-lg accent-text w-20 text-center">1:00</span></div></div>
                    </div>
                    <!-- Right Column: Player/Team Names -->
                    <div class="space-y-4">
                         <div><label for="gamemaster-name-input" class="block text-lg font-semibold accent-text mb-2">Game Master</label><input type="text" id="gamemaster-name-input" class="setup-input w-full" placeholder="Enter host's name"></div>
                         <div id="team-names-container" class="space-y-4"></div>
                    </div>
                </div>
                <div class="mt-8 border-t-2 border-main pt-6"><label class="block text-lg font-semibold text-main-secondary mb-3">Languages</label><div id="language-selector" class="flex justify-center gap-4 flex-wrap"><input type="checkbox" id="lang-da" value="da" class="lang-checkbox" checked onchange="updateLanguageSelection()"><label for="lang-da" class="lang-checkbox-label">ðŸ‡©ðŸ‡° Danish</label><input type="checkbox" id="lang-ar" value="ar" class="lang-checkbox" checked onchange="updateLanguageSelection()"><label for="lang-ar" class="lang-checkbox-label">ðŸ‡¸ðŸ‡¦ Arabic</label><input type="checkbox" id="lang-sq" value="sq" class="lang-checkbox" checked onchange="updateLanguageSelection()"><label for="lang-sq" class="lang-checkbox-label">ðŸ‡¦ðŸ‡± Albanian</label></div><p id="lang-error" class="text-red-400 text-sm mt-2 hidden">Please select at least one language.</p></div>
                <!-- Added an ID to the button for easier selection -->
                <button id="start-game-btn" onclick="initGame()" class="w-full accent-bg hover:brightness-110 text-white font-bold py-3 px-6 rounded-lg shadow-lg text-xl transition-all transform hover:scale-105 mt-8">Start Game</button>
            </div>
        </div>

        <!-- Quiz Container -->
        <div id="quiz-container" class="hidden w-full max-w-6xl mx-auto">
            <header class="relative text-center mb-4 flex justify-between items-center"><div class="w-1/3"></div><div class="w-1/3"><h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text header-gradient py-2">Family Quiz Night</h1></div><div class="w-1/3 flex justify-end items-center gap-4"><div class="flex items-center gap-2"><span id="game-master-name" class="font-semibold text-main-secondary"></span><div class="w-8 h-8 rounded-full bg-main-tertiary flex items-center justify-center"><svg class="w-5 h-5 text-main-secondary" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path></svg></div></div></div></header>
            <div id="scoreboard-container" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 bg-main-secondary/50 p-3 rounded-xl shadow-lg"></div>
            <div id="game-over" class="hidden text-center p-6 bg-main-secondary rounded-xl shadow-2xl"><h2 id="winner-message" class="text-3xl font-bold mb-4">Game Over!</h2><p class="text-lg mb-4">Final Scores:</p><div id="final-scores-container" class="flex justify-center gap-6 text-xl flex-wrap"></div><button onclick="goToHome()" class="mt-6 accent-bg hover:brightness-110 text-white font-bold py-2 px-5 rounded-lg shadow-lg transition-transform transform hover:scale-105">Play Again</button></div>
            <div id="quiz-area" class="bg-main-secondary p-4 md:p-6 rounded-xl shadow-2xl"><div class="flex justify-between items-center mb-4"><div class="flex items-center gap-3"><p id="question-counter" class="text-base font-semibold text-main-secondary">Q 1 / 30</p><button id="pause-resume-btn" onclick="togglePauseResume()" class="control-btn"></button><button onclick="resetCurrentQuestionState()" class="control-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"/><path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"/></svg></button></div><div class="relative w-20 h-20"><svg class="absolute top-0 left-0 w-full h-full" viewBox="0 0 100 100"><circle class="text-main-tertiary" stroke-width="8" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50" /><circle id="timer-progress-circle" class="timer-progress accent-text" stroke-width="8" stroke-linecap="round" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50" /></svg><div id="timer" class="absolute top-0 left-0 w-full h-full flex items-center justify-center text-xl font-bold">1:00</div></div></div><div id="question-text" class="text-xl font-semibold mb-6 space-y-4 text-center"></div><div id="answer-options" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div><div id="post-answer-controls" class="hidden mt-4 text-center"><div id="correct-answer-text" class="text-base font-semibold mb-3 text-green-400 space-y-1"></div><p class="mb-3 text-main-secondary text-sm">Award point to the correct team:</p><div id="award-points-container" class="flex justify-center gap-3 mb-3 flex-wrap"></div><button id="next-question-btn" onclick="nextQuestion()" class="w-full md:w-auto bg-main-tertiary hover:brightness-110 text-main-primary font-bold py-2 px-5 rounded-lg">Next Question</button></div><button id="reveal-answer-btn" onclick="revealAnswer()" class="hidden w-full mt-4 bg-yellow-500 hover:bg-yellow-600 text-slate-900 font-bold py-2 px-5 rounded-lg">Reveal Answer</button></div>
        </div>
    </main>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-main-secondary p-6 rounded-2xl shadow-2xl w-full max-w-3xl relative fade-in max-h-[90vh] flex flex-col">
            <button onclick="closeSettings()" class="absolute top-3 right-3 control-btn z-10"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            <h2 class="text-3xl font-bold text-center mb-6 accent-text">Settings</h2>
            <div class="space-y-6 overflow-y-auto flex-grow pr-2">
                <!-- Theme Selector -->
                <div class="pb-6">
                    <label class="block text-lg font-semibold text-main-secondary mb-4 text-center">Party Theme</label>
                    <div id="theme-selector" class="grid grid-cols-3 gap-x-4 gap-y-6 justify-items-center">
                        
                        <!-- Dark Themes -->
                        <div class="flex flex-col items-center gap-2">
                            <button id="theme-retro-wave" onclick="selectTheme('theme-retro-wave', this)" class="theme-btn"></button>
                            <span class="text-xs font-medium text-main-secondary">Retro Wave</span>
                        </div>
                        <div class="flex flex-col items-center gap-2">
                            <button id="theme-jungle-vibe" onclick="selectTheme('theme-jungle-vibe', this)" class="theme-btn"></button>
                            <span class="text-xs font-medium text-main-secondary">Jungle Vibe</span>
                        </div>
                        <div class="flex flex-col items-center gap-2">
                            <button id="theme-ocean-deep" onclick="selectTheme('theme-ocean-deep', this)" class="theme-btn"></button>
                            <span class="text-xs font-medium text-main-secondary">Ocean Deep</span>
                        </div>
                        <div class="flex flex-col items-center gap-2">
                            <button id="theme-crimson-dark" onclick="selectTheme('theme-crimson-dark', this)" class="theme-btn"></button>
                            <span class="text-xs font-medium text-main-secondary">Crimson Dark</span>
                        </div>
                        <div class="flex flex-col items-center gap-2">
                            <button id="theme-sapphire-dark" onclick="selectTheme('theme-sapphire-dark', this)" class="theme-btn"></button>
                            <span class="text-xs font-medium text-main-secondary">Sapphire Dark</span>
                        </div>
                        <div class="flex flex-col items-center gap-2">
                            <button id="theme-emerald-dark" onclick="selectTheme('theme-emerald-dark', this)" class="theme-btn"></button>
                            <span class="text-xs font-medium text-main-secondary">Emerald Dark</span>
                        </div>
                        
                        <!-- Light Themes -->
                        <div class="flex flex-col items-center gap-2">
                            <button id="theme-crimson-light" onclick="selectTheme('theme-crimson-light', this)" class="theme-btn"></button>
                            <span class="text-xs font-medium text-main-secondary">Crimson Light</span>
                        </div>
                        <div class="flex flex-col items-center gap-2">
                            <button id="theme-sapphire-light" onclick="selectTheme('theme-sapphire-light', this)" class="theme-btn"></button>
                            <span class="text-xs font-medium text-main-secondary">Sapphire Light</span>
                        </div>
                        <div class="flex flex-col items-center gap-2">
                            <button id="theme-emerald-light" onclick="selectTheme('theme-emerald-light', this)" class="theme-btn"></button>
                            <span class="text-xs font-medium text-main-secondary">Emerald Light</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL VARIABLES & DOM ELEMENTS ---
        const allScreens = document.querySelectorAll('#home-screen, #setup-screen, #quiz-container');
        const settingsModalEl = document.getElementById('settings-modal');
        const questionCounterEl = document.getElementById('question-counter');
        const questionTextEl = document.getElementById('question-text');
        const answerOptionsEl = document.getElementById('answer-options');
        const scoreboardContainer = document.getElementById('scoreboard-container');
        const finalScoresContainer = document.getElementById('final-scores-container');
        const awardPointsContainer = document.getElementById('award-points-container');
        const teamNamesContainer = document.getElementById('team-names-container');
        const gameMasterNameEl = document.getElementById('game-master-name');
        const timerEl = document.getElementById('timer');
        const timerProgressCircle = document.getElementById('timer-progress-circle');
        const postAnswerControlsEl = document.getElementById('post-answer-controls');
        const revealAnswerBtn = document.getElementById('reveal-answer-btn');
        const correctAnswerTextEl = document.getElementById('correct-answer-text');
        const pauseResumeBtn = document.getElementById('pause-resume-btn');
        const gameOverEl = document.getElementById('game-over');
        const langErrorEl = document.getElementById('lang-error');
        const pauseIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5m5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5"/></svg>`;
        const playIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/></svg>`;

        const quotes = [{ text: "The only true wisdom is in knowing you know nothing.", author: "Socrates" }, { text: "An investment in knowledge pays the best interest.", author: "Benjamin Franklin" }];
        
        // --- GAME STATE VARIABLES ---
        // Note: fullQuestionLibrary is now loaded from questions.js
        let gameQuestions = [], currentQuestionIndex = 0;
        let teamNames = [], teamScores = [];
        let gameMasterName = "Host";
        let selectedTeamCount = 2;
        // Update default theme
        let selectedQuantity = 30, selectedDifficulty = 'medium', selectedTimeLimit = 60, selectedTheme = 'theme-crimson-light';
        let selectedLanguages = ['da', 'ar', 'sq'], timerInterval, timeLeft = 60;
        let isPaused = false, answerRevealed = false, selectedAnswerIndex = null;
        
        // This will be populated by fetching questions.json
        let fullQuestionLibrary = [];
        
        // --- REMOVED: const fullQuestionLibrary = [...]
        // The entire large question array was here. It is now in questions.js


        // --- CORE FUNCTIONS ---
        window.createLangLine = (text, flag, isRtl = false) => `<div class="lang-line ${isRtl ? 'rtl' : ''}"><span class="text-xl">${flag}</span><span class="flex-1 ${isRtl ? 'arabic-text' : ''}">${text}</span></div>`;
        window.showScreen = (screenId) => { allScreens.forEach(s => s.classList.add('hidden')); document.getElementById(screenId).classList.remove('hidden'); document.getElementById(screenId).classList.add('fade-in'); window.scrollTo(0, 0); };
        window.setRandomQuote = () => { const quote = quotes[Math.floor(Math.random() * quotes.length)]; document.getElementById('quote-text').textContent = `"${quote.text}"`; document.getElementById('quote-author').textContent = `â€“ ${quote.author}`;};
        window.selectTheme = (theme, button) => { selectedTheme = theme; document.body.className = theme; document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('selected')); button.classList.add('selected');};
        window.openSettings = () => { document.querySelectorAll('#theme-selector .theme-btn').forEach(btn => btn.classList.toggle('selected', btn.id === selectedTheme)); settingsModalEl.classList.remove('hidden'); };
        window.closeSettings = () => settingsModalEl.classList.add('hidden');
        window.updateTimerSelection = (seconds) => { selectedTimeLimit = parseInt(seconds); const mins = Math.floor(selectedTimeLimit / 60); const secs = selectedTimeLimit % 60; document.getElementById('time-limit-display').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;};
        window.selectQuantity = (quantity, button) => { selectedQuantity = quantity; document.querySelectorAll('#quantity-selector button').forEach(btn => btn.classList.remove('selected')); button.classList.add('selected'); };
        window.selectDifficulty = (difficulty, button) => { selectedDifficulty = difficulty; document.querySelectorAll('#difficulty-selector button').forEach(btn => btn.classList.remove('selected')); button.classList.add('selected'); };
        window.updateLanguageSelection = () => { selectedLanguages = Array.from(document.querySelectorAll('#language-selector input:checked')).map(cb => cb.value); langErrorEl.classList.toggle('hidden', selectedLanguages.length > 0);};
        
        window.selectNumberOfTeams = (count, button) => {
            selectedTeamCount = count;
            document.querySelectorAll('#setup-content .flex.justify-center button.setup-option-btn').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            renderTeamNameInputs();
        }

        function renderTeamNameInputs() {
            teamNamesContainer.innerHTML = '';
            const teamColors = ['text-blue-400', 'text-pink-400', 'text-green-400', 'text-yellow-400'];
            for (let i = 0; i < selectedTeamCount; i++) {
                teamNamesContainer.innerHTML += `
                    <div>
                        <label for="team${i + 1}-name-input" class="block text-lg font-semibold ${teamColors[i]} mb-2">Team ${i + 1} Name</label>
                        <input type="text" id="team${i + 1}-name-input" class="setup-input w-full" placeholder="Enter name">
                    </div>
                `;
            }
        }
        
        // --- MODIFIED: initGame is now an async function to fetch questions ---
        window.initGame = async () => {
            const startButton = document.getElementById('start-game-btn');
            const originalButtonText = startButton.innerHTML;
            startButton.disabled = true;
            startButton.innerHTML = 'Loading Questions...';

            try {
                // Ensure question library is loaded by fetching it if needed
                if (fullQuestionLibrary.length === 0) {
                    console.log("Fetching questions...");
                    const response = await fetch('questions.json');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    fullQuestionLibrary = await response.json();
                    console.log("Questions loaded.");
                }

                updateLanguageSelection(); 
                if (selectedLanguages.length === 0) {
                    // Manually re-enable button if validation fails
                    startButton.disabled = false;
                    startButton.innerHTML = originalButtonText;
                    return; // Stop execution
                }
            
                // Ensure question library is loaded (check again, just in case)
                if (typeof fullQuestionLibrary === 'undefined' || !fullQuestionLibrary || fullQuestionLibrary.length === 0) {
                    alert("Error: Question library not loaded. Please wait a moment and try again.");
                    startButton.disabled = false;
                    startButton.innerHTML = originalButtonText;
                    return; // Stop execution
                }
                
                gameMasterName = document.getElementById('gamemaster-name-input').value.trim() || "Host";
                gameMasterNameEl.textContent = gameMasterName;
                
                teamNames = [];
                teamScores = [];
                for(let i = 0; i < selectedTeamCount; i++) {
                    const name = document.getElementById(`team${i+1}-name-input`).value.trim() || `Team ${i+1}`;
                    teamNames.push(name);
                    teamScores.push(0);
                }

                let availableQuestions = (selectedDifficulty === 'mixed') ? fullQuestionLibrary : fullQuestionLibrary.filter(q => q.difficulty === selectedDifficulty);
                const maxQuestions = Math.min(selectedQuantity, availableQuestions.length);
                gameQuestions = availableQuestions.sort(() => 0.5 - Math.random()).slice(0, maxQuestions);

                if (gameQuestions.length === 0) {
                    alert(`No questions found for '${selectedDifficulty}' difficulty. Please choose another difficulty.`);
                    startButton.disabled = false;
                    startButton.innerHTML = originalButtonText;
                    return; // Stop execution
                }
                
                renderScoreboard();
                showScreen('quiz-container');
                startGame();
            
            } catch (error) {
                console.error('Error loading questions:', error);
                // Note: Using alert() as it's used elsewhere in the file, though a modal would be better.
                alert('Could not load questions. Please check that questions.json file exists and try again.');
            } finally {
                // Restore button state
                startButton.disabled = false;
                startButton.innerHTML = originalButtonText;
            }
        };

        function renderScoreboard() {
            scoreboardContainer.innerHTML = '';
            const teamColors = ['text-blue-400', 'text-pink-400', 'text-green-400', 'text-yellow-400'];
            teamNames.forEach((name, i) => {
                scoreboardContainer.innerHTML += `
                    <div class="text-center">
                        <h2 class="text-lg md:text-xl font-bold ${teamColors[i]}">${name}</h2>
                        <div class="flex items-center justify-center gap-2">
                           <button onclick="adjustScore(${i}, -1)" class="control-btn text-lg">-</button>
                           <p id="team-score-${i}" class="text-3xl md:text-4xl font-bold w-16">${teamScores[i]}</p>
                           <button onclick="adjustScore(${i}, 1)" class="control-btn text-lg">+</button>
                        </div>
                    </div>
                `;
            });
        }

        window.adjustScore = (teamIndex, amount) => {
            teamScores[teamIndex] = Math.max(0, teamScores[teamIndex] + amount); // Ensure score doesn't go below 0
            document.getElementById(`team-score-${i}`).textContent = teamScores[teamIndex];
        }

        window.startGame = () => { 
            currentQuestionIndex = 0; 
            teamScores.fill(0);
            renderScoreboard();
            document.getElementById('quiz-area').classList.remove('hidden'); 
            gameOverEl.classList.add('hidden'); 
            loadQuestion(); 
        };
        
        window.loadQuestion = () => {
            resetStateForNewQuestion(); if (currentQuestionIndex >= gameQuestions.length) { endGame(); return; }
            const question = gameQuestions[currentQuestionIndex];
            questionCounterEl.textContent = `Q ${currentQuestionIndex + 1} / ${gameQuestions.length}`;
            let questionHTML = ''; const langMap = { da: 'ðŸ‡©ðŸ‡°', ar: 'ðŸ‡¸ðŸ‡¦', sq: 'ðŸ‡¦ðŸ‡±' };
            selectedLanguages.forEach(lang => { if (question.question[lang]) questionHTML += createLangLine(question.question[lang], langMap[lang], lang === 'ar'); });
            questionTextEl.innerHTML = `<div class="inline-block text-left text-lg md:text-xl space-y-2">${questionHTML}</div>`;
            answerOptionsEl.innerHTML = '';
            question.options.forEach((option, index) => {
                const button = document.createElement('button'); let optionsHTML = '';
                selectedLanguages.forEach(lang => { if (option[lang]) optionsHTML += createLangLine(option[lang], langMap[lang], lang === 'ar'); });
                button.innerHTML = `<div class="flex flex-col items-start space-y-1 text-left text-sm">${optionsHTML}</div>`;
                button.classList.add('answer-btn', 'w-full', 'p-3', 'rounded-lg', 'border-2', 'border-transparent', 'font-semibold', 'fade-in');
                button.onclick = () => selectAnswer(index, button); answerOptionsEl.appendChild(button);
            });
            startTimer();
        };

        window.selectAnswer = (index, button) => { if (answerRevealed || isPaused) return; const allButtons = answerOptionsEl.querySelectorAll('.answer-btn'); allButtons.forEach(btn => btn.classList.remove('selected')); button.classList.add('selected'); selectedAnswerIndex = index; revealAnswerBtn.classList.remove('hidden'); };
        
        window.revealAnswer = () => {
            clearInterval(timerInterval); answerRevealed = true; isPaused = true; pauseResumeBtn.innerHTML = playIcon; revealAnswerBtn.classList.add('hidden');
            const question = gameQuestions[currentQuestionIndex]; const allButtons = answerOptionsEl.querySelectorAll('.answer-btn');
            allButtons.forEach((btn, index) => { btn.disabled = true; btn.classList.remove('hover:brightness-110'); if (index === question.correctAnswerIndex) btn.classList.add('correct'); else if (index === selectedAnswerIndex) btn.classList.add('wrong'); });
            const correctOption = question.options[question.correctAnswerIndex]; let correctHTML = ''; const langMap = { da: 'ðŸ‡©ðŸ‡°', ar: 'ðŸ‡¸ðŸ‡¦', sq: 'ðŸ‡¦ðŸ‡±' };
            selectedLanguages.forEach(lang => { if (correctOption[lang]) correctHTML += createLangLine(correctOption[lang], langMap[lang], lang === 'ar'); });
            correctAnswerTextEl.innerHTML = `<p>Correct Answer:</p><div class="inline-block text-left text-sm space-y-1 bg-green-900/20 p-2 rounded-lg">${correctHTML}</div>`;
            
            renderAwardButtons();
            postAnswerControlsEl.classList.remove('hidden'); postAnswerControlsEl.classList.add('fade-in');
        };

        function renderAwardButtons() {
            awardPointsContainer.innerHTML = '';
             const teamColors = ['bg-blue-600 hover:bg-blue-700', 'bg-pink-600 hover:bg-pink-700', 'bg-green-600 hover:bg-green-700', 'bg-yellow-600 hover:bg-yellow-700'];
            teamNames.forEach((name, i) => {
                awardPointsContainer.innerHTML += `<button onclick="awardPoint(${i})" class="${teamColors[i]} text-white font-bold py-2 px-4 rounded-lg text-sm">${name}</button>`;
            });
        }

        window.awardPoint = (teamIndex) => { 
            adjustScore(teamIndex, 1);
            awardPointsContainer.querySelectorAll('button').forEach(btn => btn.disabled = true);
        };
        
        window.nextQuestion = () => { currentQuestionIndex++; loadQuestion(); };
        window.resetStateForNewQuestion = () => { clearInterval(timerInterval); answerRevealed = false; isPaused = false; selectedAnswerIndex = null; postAnswerControlsEl.classList.add('hidden'); revealAnswerBtn.classList.add('hidden'); pauseResumeBtn.innerHTML = pauseIcon; };
        window.resetCurrentQuestionState = () => { if (answerRevealed) return; selectedAnswerIndex = null; revealAnswerBtn.classList.add('hidden'); answerOptionsEl.querySelectorAll('.answer-btn').forEach(btn => btn.classList.remove('selected')); startTimer(); };
        window.startTimer = () => { clearInterval(timerInterval); timeLeft = selectedTimeLimit; isPaused = false; pauseResumeBtn.innerHTML = pauseIcon; updateTimerDisplay(); startTimerInterval(); };
        window.startTimerInterval = () => { clearInterval(timerInterval); timerInterval = setInterval(() => { if (timeLeft <= 0) { revealAnswer(); return; } timeLeft--; updateTimerDisplay(); }, 1000); };
        window.togglePauseResume = () => { if(answerRevealed) return; isPaused = !isPaused; if (isPaused) { clearInterval(timerInterval); pauseResumeBtn.innerHTML = playIcon; } else { startTimerInterval(); pauseResumeBtn.innerHTML = pauseIcon; }};
        window.updateTimerDisplay = () => { const mins = Math.floor(timeLeft / 60); const secs = timeLeft % 60; timerEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`; const progress = timeLeft / selectedTimeLimit; timerProgressCircle.style.strokeDashoffset = 283 * (1 - progress); };
        
        window.endGame = () => {
            document.getElementById('quiz-area').classList.add('hidden'); gameOverEl.classList.remove('hidden'); gameOverEl.classList.add('fade-in');
            
            finalScoresContainer.innerHTML = '';
            const teamColors = ['text-blue-400', 'text-pink-400', 'text-green-400', 'text-yellow-400'];
            let highScore = -1;
            let winners = [];

            teamScores.forEach((score, i) => {
                finalScoresContainer.innerHTML += `<p><span class="font-bold ${teamColors[i]}">${teamNames[i]}:</span> <span>${score}</span></p>`;
                if (score > highScore) {
                    highScore = score;
                    winners = [teamNames[i]];
                } else if (score === highScore) {
                    winners.push(teamNames[i]);
                }
            });

            const winnerMessageEl = document.getElementById('winner-message');
            winnerMessageEl.className = 'text-3xl font-bold mb-4';
            if (winners.length > 1 && highScore > 0) {
                winnerMessageEl.textContent = `It's a Tie! ðŸ¤`;
            } else if (winners.length === 1) {
                winnerMessageEl.textContent = `${winners[0]} Wins! ðŸŽ‰`;
                const winnerIndex = teamNames.indexOf(winners[0]);
                winnerMessageEl.classList.add(teamColors[winnerIndex]);
            } else {
                 winnerMessageEl.textContent = "Game Over!";
            }
        };
        window.goToHome = () => { clearInterval(timerInterval); setRandomQuote(); showScreen('home-screen'); };

        // --- INITIAL LOAD ---
        window.onload = () => {
            // Check if the theme is already set (e.g., from localStorage in a future update)
            // If not, set the default
            if (!document.body.className.includes('theme-')) {
                 selectTheme(selectedTheme, document.getElementById(selectedTheme));
            }
            // Ensure the correct theme button is selected on load
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('selected'));
            const currentThemeBtn = document.getElementById(selectedTheme);
            if (currentThemeBtn) {
                currentThemeBtn.classList.add('selected');
            }
            
            selectNumberOfTeams(2, document.querySelector('#setup-content .flex.justify-center button.setup-option-btn'));
            goToHome();
        };
    </script>
</body>
</html>
